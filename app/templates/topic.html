{% extends "base.html" %}

{% block head %}
    <title>Topic: {{topic.name}}</title>
    <link rel="stylesheet" type="text/css" href="/static/topic.css">
{% endblock %}

{% block content %}
<h1>{{topic.name}}
{% if topic.author == current_user or current_user.role < 2 %}
<sup><a href="{{url_for('delete_topic', topic_id=topic.id)}}"><img src="/static/icon_del.png"></a><sup>
{% endif %}
</h1>

<hr>

{% for message in topic.message[pagination.first:pagination.last] %}
<div class="avatar">
    <a href="{{url_for('user_profile', user_id=message.author.id)}}">
        <img src="{{message.author.avatar_thumb}}" title="{{message.author.login}}">
    </a>
</div>

<div class="message_block">
    <div class="message_body" id="{{loop.index}}">
        <div class="message_info tiny"><a class="tiny" href="{{request.url}}#{{loop.index}}">#{{loop.index}}:</a>
            posted by <a class="tiny" href="{{url_for('user_profile', user_id=message.author_id)}}">{{message.author.login}}</a>,
            {{message.date.strftime('%H:%M, %d %b %Y')}}{% if message.date_edit %},
            edited
            {% if message.editor and message.editor != message.author %}
            by <a class="tiny" href="{{url_for('user_profile', user_id=message.editor_id)}}">{{message.editor.login}}</a>
            {% endif %}
            at {{message.date_edit.strftime('%H:%M, %d %b %Y')}}
            {% endif %}
        </div>
        {% if message.author == current_user or current_user.role < 2 %}
        <div class="message_options tiny">
            <a class="edit_del tiny red" href="{{url_for('edit_message', message_id=message.id)}}">Edit</a>
            <a class="edit_del tiny red" href="{{url_for('delete_message', message_id=message.id)}}">Delete</a>
        </div>
        {% endif %}
        <hr>
        <div class="message_text normal">{{message.text|safe}}</div>
    </div>
</div>
{% endfor %}

<div class="pages">
    <a class="page_firstlast" href="{{url_for('topic', topic_id=topic.id, page=1)}}">First</a>
{% for page_number in pagination.pages_list %}
    {% if page_number == pagination.page %}
    <a class="current_page_number" href="{{url_for('topic', topic_id=topic.id, page=page_number)}}">{{page_number}}</a>
    {% else %}
    <a class="page_number" href="{{url_for('topic', topic_id=topic.id, page=page_number)}}">{{page_number}}</a>
    {% endif %}
{% endfor %}
    <a class="page_firstlast" href="{{url_for('topic', topic_id=topic.id, page=pagination.pages)}}">Last</a>
</div>

<hr>

{% if user.is_authenticated() %}
<form method="post" onsubmit="return PostingFormValidate()">
    {{form_message.hidden_tag()}}
    <div class="format_block">
        <img class="format_button" src="/static/button_bold.png" onclick="makeFormated('b')">
        <img class="format_button" src="/static/button_italic.png" onclick="makeFormated('i')">
        <img class="format_button" src="/static/button_underlined.png" onclick="makeFormated('u')">
        <img class="format_button" src="/static/button_url.png" onclick="makeURL('url')">
        <img class="format_button" src="/static/button_img.png" onclick="makeIMG('img')">
    </div>
    {{form_message.message(placeholder='Enter your text here', class="normal", onkeyup="PostingFormUnmark(this)")}}
    <input class="submit" type="submit" value="Post">
</form>
{% endif %}

{% endblock %}